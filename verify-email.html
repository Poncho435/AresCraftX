<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Подтверждение Email - AresCraftX</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body style="background: #0a0a0a; color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh;">
    <div style="text-align: center; padding: 40px; max-width: 500px;">
        <div style="font-size: 4rem; color: #ff6600; margin-bottom: 20px;">
            <i class="fas fa-envelope-open-text"></i>
        </div>
        
        <h1 style="color: #ff6600;">Подтверждение Email</h1>
        
        <div id="status-message" style="
            background: rgba(255, 102, 0, 0.1);
            border: 2px solid #ff6600;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
        ">
            <h2><i class="fas fa-spinner fa-spin"></i> Проверяем ваш email...</h2>
            <p>Пожалуйста, подождите...</p>
        </div>
        
        <div style="margin-top: 30px;">
            <a href="auth.html" style="
                background: #ff6600;
                color: white;
                padding: 12px 30px;
                border-radius: 50px;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                gap: 10px;
                font-weight: bold;
            ">
                <i class="fas fa-sign-in-alt"></i> Перейти к входу
            </a>
        </div>
    </div>
    
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://vclifktmbyaxwybpakgv.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZjbGlma3RtYnlheHd5YnBha2d2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3NjM0OTgsImV4cCI6MjA4NTMzOTQ5OH0.pOyne6Hs71mUe12_lx0a4go_PmGisVXpDPbDK0nwwro';
        
        async function verifyEmail() {
            const urlParams = new URLSearchParams(window.location.search);
            const token_hash = urlParams.get('token_hash');
            const type = urlParams.get('type');
            
            if (type === 'signup' && token_hash) {
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                
                try {
                    const { data, error } = await supabase.auth.verifyOtp({
                        token_hash,
                        type: 'signup'
                    });
                    
                    const messageDiv = document.getElementById('status-message');
                    
                    if (error) {
                        messageDiv.innerHTML = `
                            <h2 style="color: #ff3300;"><i class="fas fa-times-circle"></i> Ошибка!</h2>
                            <p>${error.message}</p>
                            <p>Ссылка для подтверждения недействительна или устарела.</p>
                        `;
                    } else {
                        messageDiv.innerHTML = `
                            <h2 style="color: #00aa00;"><i class="fas fa-check-circle"></i> Успешно!</h2>
                            <p>Ваш email подтвержден!</p>
                            <p>Теперь вы можете войти в свой аккаунт.</p>
                        `;
                        
                        // Автоматический редирект через 5 секунд
                        setTimeout(() => {
                            window.location.href = 'auth.html?verified=true';
                        }, 5000);
                    }
                } catch (error) {
                    console.error('Ошибка:', error);
                }
            }
        }
        
        document.addEventListener('DOMContentLoaded', verifyEmail);
    </script>
</body>
</html>